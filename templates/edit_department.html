{% extends "base.html" %}

{% block title %}تعديل قسم - نظام الموارد البشرية{% endblock %}

{% block content %}
<div class="form-container">
    <div class="form-header">
        <h1><i class="fas fa-edit"></i> تعديل قسم: {{ department.name }}</h1>
        <a href="{{ url_for('departments') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-right"></i> العودة إلى القائمة
        </a>
    </div>

    <div class="department-summary">
        <div class="summary-card">
            <div class="summary-icon">
                <i class="fas fa-building"></i>
            </div>
            <div class="summary-info">
                <h3>{{ department.name }}</h3>
                <p>{{ department.employee_count }} موظف</p>
                <div class="summary-meta">
                    <span class="created-date">
                        أنشئ في: {{ department.created_at.strftime('%Y-%m-%d') }}
                    </span>
                </div>
            </div>
        </div>
    </div>

    <form method="POST" class="department-form">
        <div class="form-grid">
            <div class="form-group">
                <label for="name">اسم القسم *</label>
                <input type="text" id="name" name="name" 
                       value="{{ department.name }}" required>
                <div class="form-error" id="name_error"></div>
            </div>
            
            <div class="form-group">
                <label for="manager_id">مدير القسم</label>
                <select id="manager_id" name="manager_id">
                    <option value="">لا يوجد مدير</option>
                    {% for manager in managers %}
                    <option value="{{ manager.id }}" 
                        {% if department.manager_id == manager.id %}selected{% endif %}>
                        {{ manager.full_name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
        </div>
        
        <div class="form-group">
            <label for="description">وصف القسم</label>
            <textarea id="description" name="description" rows="4">{{ department.description or '' }}</textarea>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i> حفظ التعديلات
            </button>
            <button type="reset" class="btn btn-secondary">
                <i class="fas fa-undo"></i> إعادة تعيين
            </button>
            <a href="{{ url_for('departments') }}" class="btn btn-outline">
                <i class="fas fa-times"></i> إلغاء
            </a>
        </div>
    </form>

    {% if department_employees %}
    <div class="department-employees">
        <h3><i class="fas fa-users"></i> موظفو القسم</h3>
        <div class="employees-list">
            {% for employee in department_employees %}
            <div class="employee-item">
                <div class="employee-avatar">
                    <i class="fas fa-user-circle"></i>
                </div>
                <div class="employee-details">
                    <h4>{{ employee.first_name }} {{ employee.last_name }}</h4>
                    <p>{{ employee.position }}</p>
                    <span class="employee-status status-{{ employee.status }}">
                        {% if employee.status == 'active' %}نشط{% else %}غير نشط{% endif %}
                    </span>
                </div>
                <div class="employee-actions">
                    <a href="{{ url_for('edit_employee', employee_id=employee.id) }}" 
                       class="btn btn-sm btn-edit">
                        <i class="fas fa-edit"></i>
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>

<style>
.department-summary {
    margin-bottom: 2rem;
}

.summary-card {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 1.5rem;
    border-radius: 10px;
}

.summary-icon {
    font-size: 2.5rem;
}

.summary-info h3 {
    margin: 0 0 0.5rem 0;
    font-size: 1.5rem;
}

.summary-info p {
    margin: 0 0 0.5rem 0;
    opacity: 0.9;
}

.summary-meta {
    font-size: 0.9rem;
    opacity: 0.8;
}

.department-employees {
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 2px solid #ecf0f1;
}

.department-employees h3 {
    color: #2c3e50;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.employees-list {
    display: grid;
    gap: 1rem;
}

.employee-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: #f8f9fa;
    border-radius: 8px;
    border: 1px solid #e9ecef;
}

.employee-avatar {
    font-size: 2rem;
    color: #3498db;
}

.employee-details {
    flex: 1;
}

.employee-details h4 {
    margin: 0 0 0.25rem 0;
    color: #2c3e50;
}

.employee-details p {
    margin: 0 0 0.25rem 0;
    color: #7f8c8d;
    font-size: 0.9rem;
}

.employee-status {
    padding: 0.2rem 0.6rem;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 500;
}

.status-active {
    background: #d5f4e6;
    color: #27ae60;
}

.status-inactive {
    background: #fadbd8;
    color: #e74c3c;
}
</style>

<script>
function validateForm() {
    let isValid = true;
    
    document.querySelectorAll('.form-error').forEach(el => {
        el.style.display = 'none';
    });
    
    const name = document.getElementById('name');
    if (!name.value.trim()) {
        showError('name_error', 'يرجى إدخال اسم القسم');
        isValid = false;
    }
    
    return isValid;
}

function showError(elementId, message) {
    const errorElement = document.getElementById(elementId);
    errorElement.textContent = message;
    errorElement.style.display = 'block';
}

document.querySelector('.department-form').addEventListener('submit', function(e) {
    if (!validateForm()) {
        e.preventDefault();
    }
});
</script>
{% endblock %}